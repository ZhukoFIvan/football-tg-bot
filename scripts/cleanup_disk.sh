#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∏—Å–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "======================================"
echo "üßπ –û–ß–ò–°–¢–ö–ê –î–ò–°–ö–ê"
echo "======================================"
echo ""

echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–∏—Ç:"
echo "  - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Docker –æ–±—Ä–∞–∑—ã"
echo "  - –°—Ç–∞—Ä—ã–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã"
echo "  - Docker –ª–æ–≥–∏"
echo "  - –ö—ç—à Docker build"
echo ""
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
    exit 1
fi

echo ""
echo "1Ô∏è‚É£  –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö Docker –æ–±—Ä–∞–∑–æ–≤..."
docker image prune -a -f

echo ""
echo "2Ô∏è‚É£  –£–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
docker container prune -f

echo ""
echo "3Ô∏è‚É£  –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö volumes..."
docker volume prune -f

echo ""
echo "4Ô∏è‚É£  –£–¥–∞–ª–µ–Ω–∏–µ build –∫—ç—à–∞..."
docker builder prune -a -f

echo ""
echo "5Ô∏è‚É£  –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ Docker (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)..."
sudo find /var/lib/docker/containers -name "*.log" -mtime +7 -delete 2>/dev/null || echo "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º Docker"

echo ""
echo "6Ô∏è‚É£  –û—á–∏—Å—Ç–∫–∞ apt –∫—ç—à–∞..."
sudo apt-get clean 2>/dev/null || echo "apt-get –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "======================================"
echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "======================================"
echo ""

# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo "üìä –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:"
df -h /
echo ""

echo "üê≥ Docker –∑–∞–Ω–∏–º–∞–µ—Ç:"
docker system df


